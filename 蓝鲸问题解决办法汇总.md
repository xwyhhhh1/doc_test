## 蓝鲸问题解决办法汇总

#### 1、问题：ERROR  deploy failed: timeout

+ 解决办法1：在蓝鲸问答社区中寻找到了解决办法

  + ```shell
    首先首先是查看日志，看看是否是报错的其它问题
    cat /data/bkce/logs/paasagent/agent.log
    ```

  + 然后是修改配置文件中的超时选项

  + 参考文档https://bk.tencent.com/s-mart/community/question/1405

    + ```shell
      #修改 paas_agent 模版配置文件的 EXECUTE_TIME_LIMIT 配置项
      vim /data/src/paas_agent/support-files/templates/#etc#paas_agent_config.yaml.tpl
      #修改EXECUTE_TIME_LIMIT=300这一项，改成30000即可
      ```

    + ```SHELL
      #修改 open_paas 模版配置文件
      vim /data/src/open_paas/support-files/templates/paas#conf#settings_production.py.tpl
      # 在配置文件内任意处新增该配置项。
      EVENT_STATE_EXPIRE_SECONDS = 3600
      
      ```

  + 重新渲染配置文件

    + ```shell
      # paas
      ./bkcli render paas
      ./bkcli restart paas
      # appo
      ./bkcli install appo
      ./bkcli restart appo
      ```
  
+ 解决办法2：可参考pdf文档

+ 解决办法3：修改配置

  + ```shell
    #首先确定是否因为时间问题导致部署失败
    for i in $(cat /data/install/install.config | awk '{print $1}' | grep -Ev "^\[" | grep -Ev "^$" | sort | uniq) ; do echo $i ; ssh $i -C date ;done
    #并非时间问题且以上其它方法试过
    vim /data/bkce/paas_agent/paas_agent/etc/build/docker/saas/starter
    #修改配置为以下
    #使用加密的python前，需要指定BK_ENV_FILE的环境变量指向priv文件的绝对路径
        export BK_FILE_PATH=$CODE_PATH/conf/saas_priv.txt
        if [ "$BK_CRYPT_VERSION" == '3' ]; then
    ```

  + 


#### 2、问题：因为内存不足强行关机添加了一些内存后，开启虚拟机，再次安装报 zk.service.consul无法解析错误

+ 排查过程：首先是查看服务运行状态是否正常，一看全部在报error错误，无法解析我自己的地址

+ 再看consul-temple服务状态，发现根本不能识别我自己

+ 解决办法：在/etc/resolv.conf里直接添加dns解析我自己

  + ```shell
     vi /etc/resolv.conf 
     nameserver 127.0.0.1
    ```

+ 重启consul，和consul-temple

#### 3、问题：见下图

![image-20220221114526789](http://xwyhhhh1.test.upcdn.net/image-20220221114526789.png)

+ 排查过程
   + 首先看到他报命令不存在问题，首先查看是否存在此命令，结果是存在
   + 下一步翻译error错误问题提示，也是找不到这个命令
   + 百度查找，发现原因，rsync分发文件另一台也需要有同样命令
   + 在从机上安装rsync，问题解决
+ *参考文档*：https://blog.csdn.net/gdkyxy2013/article/details/105801656

#### 4、问题：初始化拓扑发现吧lesscode模板不存在错误

- 标准运维安装监控平台到初始化拓扑失败

- ![image-20220607171802337](http://xwyhhhh1.test.upcdn.net/image-20220607171802337.png)

- ```shell
  #解决方案 
  #部署监控平台的机器上，去除lesscode即可
  vi /data/bkce/.installed_module
  ```

#### 5、问题标准运维调用jobapi问题

- 问题描述：

  - 调用job接口job.get_script_list返回失败, params={"bk_biz_id":"2","is_public":false,"script_type":0}, error=Component request third-party system [JOB] interface [get_script_list] error: HTTPSConnectionPool(host='job-gateway.service.consul', port=10503): Max retries exceeded with url: /api/job/v2/job-manage/get_script_list/ (Caused by NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x7fc923248450>: Failed to establish a new connection: [Errno -2] Name or service not known',)), please try again later or contact component developer to handle this

- 问题原因：job-gatway组件挂掉，查看内存可发现内存不足一个G

- 解决方案

  - ```shell
    #查看内存
    free -h
    #清楚缓存
    echo 3 >> /proc/sys/vm/drop_caches
    #job机器重启服务
    systemctl restart bk-job-gatway.service
    ```

#### 6、企业版proxy资源不可用问题

- 问题描述：国泰企业版2.x版本蓝鲸的proxy机器对下属的四百多台机器分发文件出现资源不可用的问题，已知此proxy机器属于几年前的机器，并且此proxy一直正常运行，并未脱离过蓝鲸也并未下线过还没有停用过，更不曾归属到其它业务并且伴随归档，问题截图如下图
- 推测原因：已知此proxy机器属于几年前的机器，推测可能并未做过任何的初始化操作，或者有初始化的操作漏做的可能；刚好新上业务需要使用这台proxy或者其它原因使用proxy，批量的对大量主机进行操作，导致问题发生。
  - ![image-20220608115928805](http://xwyhhhh1.test.upcdn.net/image-20220608115928805.png)

- 解决方案

  - ```shell
    #首先确定umilit，观察输出结果是否为102400
    umilit -n
    #如若为1024请查看相关配置文件,观察输出结果是否包含root soft nofile 102400，root hard nofile 102400这两项
    tail -10 /etc/security/limits.conf
    #如若没有请添加，如若有请退出当前终端重新连接使其生效
    ```
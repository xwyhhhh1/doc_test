## 杉欣数科项目实施技术评估

### 一、CMDB实现评估

#### 1.实现技术

##### 1.1配合蓝鲸套餐包部署实现

###### 1.1.1环境准备

```shel
#关闭防火墙
systemctl stop firewalld && systemctl disable
#如果防火墙为iptables,那么应该清除所有规则
iptables -XFZ 
#关闭selinux策略
setenforce 0 && sed -i "s/SELINUX=Enforcing/SELINUX=disabled/g" /etc/selinux/config
sestatus
#机器环境中应包含epel扩展源和epeo源
curl -O http://mirrors.aliyun.com/repo/Centos-7.repo && mv /etc/yum.repos.d/Centos-7.repo /etc/yum.repos.d/CentOS-Base.repo
curl -O http://mirrors.aliyun.com/repo/epel-7.repo && mv /etc/yum.repos.d/epel-7.repo /etc/yum.repos.d/epel.repo
#请清除缓存和重建缓存
yum clean all
yum makecache fast
#安装cmdb需要正确的时间，请同步时间
ntpdate time.windows.com
#如果没有这条命令，应该先安装命令包
yum -y install ntpdate
#检查时间是否准确
date
#安装蓝鲸时需要rsync的支持，请检查是否安装了rsync
which rsync
#如果报错，请尝试安装
yum -y install rsync
#安装蓝鲸时需要调整文件最大打开数量的限制，请修改
cat > /etc/security/limits.conf << EOF
root soft nofile 102400
root hard nofile 102400
EOF
#退出终端重新连接，查看是否成功
ulimit -n
#检查是否有全局代理
echo $http_proxy $https_proxy


#请确保上述条件在每台机器上完成，这些是基础环境，如果环境准备不到位，可能会导致部署失败。请务必确认！！！
#请检查主机名是否相同，要保证每台的名字不同，请确认此项！！！
```

###### 1.1.2产品准备

```shell
#请确认自己的证书包，是否由部署机器的mac地址生成
#请确认基础套餐包已上传
#请解压基础套餐包到指定路径
tar -xf xxxxxx -C /data/
#请解压产品包
cd /data/src/; for f in *gz;do tar xf $f; done
#请拷贝蓝鲸公共组件的yum仓库到指定目录下
cp -a /data/src/yum /opt
#请创建证书包解压目录，并赋予目录相应权限
install -d -m 755 /data/src/cert
#请将证书包解压到指定目录下
tar xf /data/ssl_certificates.tar.gz -C /data/src/cert/
#请赋予访问证书包的权限
chmod 644 /data/src/cert/*
#请准备自己访问的域名及密码
#请调用脚本指定自己的域名及安装目录，安装目录一般默认为/data/bkce，请不要修改。
cd /data/install && ./configure -d (域名) -p /data/bkce
#请修改values值，为您自己的密码
cat > /data/install/bin/03-userdef/usermgr.env << EOF
BK_PAAS_ADMIN_PASSWORD=BlueKing
EOF
#请准备install.config文件
cp install.config.3ip.sample  install.config
#请将文件中的ip修改成您的实际ip
vim install.config
#若无vim编辑器，请使用vi或安装vim
yum -y install vim
#请执行免密脚本
cd /data/install
bash /data/install/configure_ssh_without_pass


#以上步骤请在中控机上执行，请务必全部完成！！！

```

###### 1.1.3安装部署

```shell
#部署蓝鲸需要公共组件支持，请调用部署脚本部署公共组件
cd /data/install && ./bk_install common
#以上没有报错请调用检查脚本，检查环境是否准确无误
./health_check/check_bk_controller.sh
#环境通过，即可开始部署
#paas为蓝鲸的门户，安装cmdb之前需要先安装门户
./bk_install paas
#paas实现需要另外两个saas的配合，但是saas依赖于正式环境和测试环境，因此请先安装环境
./bk_install app_mgr
#部署依赖saas
./bk_install saas-o bk_user_manage
./bk_install saas-o bk_iam
#实现这些后可以调用脚本部署cmdb
./bk_install cmdb

#请中控机上执行此安装部署命令！！！
```

#### 2.技术评估

###### 2.1难度：较低

###### 2.2注意事项：前期准备环境工作

######2.3细节方面请不要忽略

### 二、JOB实现评估

#### 1.实现技术

##### 1.1配合蓝鲸套餐实现安装

###### 1.1.1环境准备

```shell
#job的安装部署需要建立在paas与cmdb安装之后的情况下
```

###### 1.1.2安装部署

```shell
#请参考一cmdb搭建实现,在此基础上搭建job
#请确认一是否成功，成功即可进行job安装
#请调用安装脚本进行部署
cd /data/install/ 
./bk_install job
#请检查执行结果是否报错，如果错误请先排除错误，再尝试重新安装

#以上操作请在中控机上执行！！！
```

#### 2.技术实现评估

###### 2.1难度：较低,一人即可完成

###### 2.2注意事项：paas、cmdb是否已成功部署

###三、监控平台、故障自愈、日志平台

####1.实现技术

##### 1.1配合蓝鲸套餐，使用saas功能进行安装

###### 1.1.1环境准备

```shell
#此安装需要在二完成的基础上，请先完成二的安装
#请检查二是否安装部署成功
#部署此监控、故障、日志需要基础套餐安装成功因此，请先完成基础套餐的安装
#请调用安装脚本进行节点管理saas的安装
cd install
./bk_install saas-o bknodeman 
#请检查部署saas是否报错，在确认成功的情况下，进行标准运维saas部署
./bk_install saas-o bk_sops
#请检查部署saas是否报错，在确认成功的情况下，进行流程服务saas部署
./bk_install saas-o bk_itsm

#安装此三件需要增强套餐的安装包，请确认您已上传至中控机上并已解压

#请确认以上操作已在中控机上完成!!!

#请在节点管理中确认部署的机器是否已进行agent节点管理，如若没有，见下图
#请在安装节点管理成功后，对将要部署的机器执行免密，请在中控机上执行
#免密成功后，请使用标准运维进行安装
#在蓝鲸6.x版本，已不支持后台进行安装，因此需要标准运维部署，标准运维安装部署需要导入模板，因此，请前往此链接下载模板https://bkopen-1252002024.file.myqcloud.com/ce/bk_sops_co_package-6.0.4.dat
```

![image-20220402165904301](http://xwyhhhh1.test.upcdn.net/image-20220402165904301.png)

###### 1.1.2安装部署

1.导入标准运维模板

![image-20220402171800147](http://xwyhhhh1.test.upcdn.net/image-20220402171800147.png)

2.部署监控平台

![image-20220402171939050](http://xwyhhhh1.test.upcdn.net/image-20220402171939050.png)

![image-20220402172450157](http://xwyhhhh1.test.upcdn.net/image-20220402172450157.png)

![image-20220402172625001](http://xwyhhhh1.test.upcdn.net/image-20220402172625001.png)

3.部署日志平台

![image-20220402172740451](http://xwyhhhh1.test.upcdn.net/image-20220402172740451.png)

![image-20220402172811773](http://xwyhhhh1.test.upcdn.net/image-20220402172811773.png)

![image-20220402172845815](http://xwyhhhh1.test.upcdn.net/image-20220402172845815.png)

4.部署故障自愈

![image-20220402172936143](http://xwyhhhh1.test.upcdn.net/image-20220402172936143.png)

![image-20220402173008904](http://xwyhhhh1.test.upcdn.net/image-20220402173008904.png)

![image-20220402173041676](http://xwyhhhh1.test.upcdn.net/image-20220402173041676.png)

#### 2.技术实现评估

2.1难度：较低

2.2注意事项：免密，agent的实现
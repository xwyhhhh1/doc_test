## 中国电信互联网事业部蓝鲸社区版6.0.3部署文档

### 1.基础套餐部署

基础套餐内容：4 个基础平台和 4 个基础 SaaS

| 基础平台 | 基础 SaaS |
| -------- | --------- |
| 管控平台 | 用户管理  |
| 配置平台 | 权限中心  |
| 作业平台 | 节点管理  |
| paas平台 | 标准运维  |

基础套餐下载：https://bkopen-1252002024.file.myqcloud.com/ce/bkce_basic_suite-6.0.3.tgz

#### 1.1 系统环境准备

1、SELinux配置

```shell
#设置SELinux为disabled、临时关闭
setenforce 0

#永久关闭
sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config 

#重启
reboot  

#查看SELinux状态
getenforce  
```

2、防火墙配置

```shell
#关闭防火墙
systemctl stop firewalld

#禁止开机自启
systemctl disable firewalld 

#查看防火墙状态
firewall-cmd --state  
```

3、NetworkManager配置

```shell
#关闭NetworkManager
systemctl stop NetworkManager 

#设置开机不自启
systemctl disable NetworkManager    
```

4、yum源和pip源配置

```shell
#安装wget
yum install -y wget

#下载腾讯yum和epel源
 mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
 wget -O /etc/yum.repos.d/CentOS-Base.repo  http://mirrors.cloud.tencent.com/repo/centos7_base.repo
 
# 注：如果只部署基础模块可以使用腾讯云、需要部署增强套餐请使用阿里云
#更新配置epel源
 mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak
wget -O /etc/yum.repos.d/epel.repo http://mirrors.cloud.tencent.com/repo/epel-7.repo
 
#配置阿里云epel源
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo

#下载epel-release
yum -y install epel-release  

#清除缓存
yum clean all 

#重新建立
yum makecache

#下载nginx依赖
yum install -y gcc gcc-c++ wget curl telnet openssl openssl-devel rsynclrzsz 
 
#创建目录和文件
mkdir /root/.pip && touch /root/.pip/pip.conf

#修改pip源
cat >>/root/.pip/pip.conf<<EOF
[global]
index-url=https://pypi.douban.com/simple
trusted-host = pypi.douban.com
EOF

```

5、安装rsync

```shell
yum install -y rsync
```

6、调整文件打开数

```shell
#查看最大打开数
ulimit -n   
```

默认一般为1024，建议调整为102400以上，但是不可大于/proc/sys/fs/nr_open 的值， 该值默认为 1048576。

```shell
#编辑/etc/security/limits.conf配置文件
cat >> /etc/security/limits.conf << EOF 
root soft nofile 102400
root hard nofile 102400
EOF

#修改完后需要终端重新连接或者重启主机
```

7、配置时间同步

```shell
#检查时区和时间差，若时间差达到3s请校正时间
date -R 

#下载ntpdate
yum -y install ntpdate

#查看ntp server时差，若offset大于1，请校正时间
ntpdate -d cn.pool.ntp.org  
```

如果时间不同步或者说是差值较大，将会影响后续安装，比如在初始化蓝鲸业务拓扑的时候会出现报错。

```shell
#配置ntp server同步时间
ntpdate cn.pool.ntp.org 
```

8、检查主机名（避免主机名一样）

```shell
#检查主机名
hostname    

 #修改主机名
hostnamectl set-hostname xxx   

#查看是否修改成功
cat /etc/hostname 

#变更主机名
bash    
```

9、检查/etc/resolv.conf

```shell
#如果首行没有127.0.0.1需要进行添加、添加后不要进行主机重启、如需重启需要重新进行127.0.0.1的添加操作
cat /etc/resolv.conf
nameserver 127.0.0.1
; generated by /usr/sbin/dhclient-script
nameserver 192.168.0.1
```

10、关闭ipv6

```shell
#编辑/etc/sysctl.conf 
vi /etc/sysctl.conf 
net.ipv6.conf.all.disable_ipv6=1

#编辑 /etc/sysconfig/network 配置
vi /etc/sysconfig/network
NETWORKING_IPV6=no

#关闭开启自启
ipv6 systemctl disable ip6tables.service

#查看
sysctl -p
net.ipv6.conf.all.disable_ipv6 = 1
```

#### 1.2 蓝鲸部署前准备

基础套餐包含组件具体内容及版本号：

```shell
PaaS（2.12.10）
配置平台（3.9.22）
作业平台（3.2.7.3）
权限中心（1.6.1）
用户管理（2.2.5-1）
节点管理（2.0.847）
标准运维（3.6.38）
流程服务（2.5.8.281）
bkce_install（3.0.8）
```

1、解压套餐包

```shell
#创建data目录
mkdir /data

#切换目录解压安装包
cd /data
tar xf bkce_basic_suite-6.0.3.tgz
```

2、解压src各个产品软件包

```shell
cd /data/src/; for f in *gz;do tar xf $f; done
```

3、解压证书包

```shell
install -d -m 755 /data/src/cert
tar xf /data/ssl_certificates.tar.gz -C /data/src/cert/
chmod 644 /data/src/cert/*
```

4、拷贝rpm包文件夹到opt目录

```shell
cp -a /data/src/yum /opt
```

5、配置install.config

```shell
# 请根据实际机器的 IP 进行替换第一列的示例 IP 地址，确保主机 IP 之间能互相通信、根据实际的主机进行规划
cat << EOF >/data/install/install.config
10.10.9.30 iam,ssm,usermgr,gse,license,redis,consul,mysql
10.10.9.31 nginx,consul,mongodb,rabbitmq,appo
10.10.9.32 paas,cmdb,job,zk(config),appt,consul,nodeman(nodeman)
EOF
```

6、配置免密

```shell
cd /data/install
bash /data/install/configure_ssh_without_pass
```

#### 1.3 部署蓝鲸社区版

1、配置访问域名

```shell
#指定具体访问蓝鲸域名
./configure  -d bks.com
```

2、初始化并检查环境

```shell 
# 初始化环境
./bk_install common

# 校验环境和部署的配置
./health_check/check_bk_controller.sh
```

3、标准部署

```shell
#部署 PaaS 平台、 安装 PaaS 平台及其依赖服务
#PaaS 平台部署完成后，可以访问蓝鲸的 PaaS 平台
./bk_install paas

# 部署 app_mgr、部署 SaaS 运行环境，正式环境及测试环境
./bk_install app_mgr


# 权限中心
./bk_install saas-o bk_iam

# 用户管理
./bk_install saas-o bk_user_manage

# 部署 CMDB、安装配置平台及其依赖服务
./bk_install cmdb

#部署 JOB、 安装作业平台后台模块及其依赖组件
./bk_install job


#注：如需使用跨云管控，请提前将节点管理的外网 IP 写入至节点管理后台服务所在机器的/etc/blueking/env/local.env 文件
# 加载蓝鲸相关维护命令
source ~/.bashrc
source /data/install/utils.fc

ssh $BK_NODEMAN_IP "cat >> /etc/blueking/env/local.env <<_EOF
WAN_IP=$(curl -s icanhazip.com)
_EOF"

# 安装节点管理后台模块、节点管理 SaaS 及其依赖组件
./bk_install bknodeman


# 标准运维
./bk_install saas-o bk_sops

# 流程管理
./bk_install saas-o bk_itsm

#初始化蓝鲸业务拓扑
./bkcli initdata topo

#检查服务状态
cd /data/install/
echo bkssm bkiam usermgr paas cmdb gse job consul | xargs -n 1 ./bkcli check
```

#### 1.4 访问蓝鲸

1、配置本地hosts

```shell
C:\Windows\System32\drivers\etc\hosts

#添加、注：10.10.9.31 nginx 模块所在的机器，10.10.9.32 为 nodeman 模块所在的机器。IP 需更换为本机浏览器可以访问的 IP
10.10.9.31 paas.bks.com cmdb.bks.com job.bks.com jobapi.bks.com
10.10.9.32 nodeman.bks.com

#查询模块所分布在机器的方式：
grep -E "nginx|nodeman" /data/install/install.config

#获取账号密码
grep -E "BK_PAAS_ADMIN_USERNAME|BK_PAAS_ADMIN_PASSWORD" /data/install/bin/04-final/usermgr.env
```

2、访问蓝鲸工作台：http://paas.bks.com/

![image-20210603112617720](https://i.loli.net/2021/06/03/1gZtk57UfR2oMOi.png)

### 2.节点管理安装Agent

1、安装步骤

![](https://i.loli.net/2021/06/02/HIp48ORsbyZ6VxP.jpg)

![](https://i.loli.net/2021/06/02/ncFEq4i1DVkN7CM.png)

2、部署日志、可以通过日志进行查看是否有错误

![valueinstall_agent](https://i.loli.net/2021/06/03/qhEIWbxPkBNagC7.png)

### 3.增强套餐部署

> 增强套餐包含：监控、日志、故障自愈
>
> 在部署监控日志之前可以检查主机内存使用情况、如果内存足够、可以将监控日志安装在原有的主机上、新增主机请和中控机进行免密操作

#### 3.1 前期准备

1、实现免密

```shell
#开始部署前，请确保新增主机跟中控机已实现免密
ssh-copy-id <ip>
```

2、主机进行agent安装

- 节点管理进行安装、具体请参考“节点管理安装agent”

3、解压安装包

```shell
#将安装包上传至中控机进行解压
cd /data
tar xf bkce_co_package-6.0.3.tgz
```

4、将需要部署产品的标准运维流程模版导入至标准运维

- 下载标准运维流程模块：https://bkopen-1252002024.file.myqcloud.com/ce/bk_sops_co_package-6.0.3.dat

**详细步骤：** `打开标准运维 -> 项目流程 -> 导入 -> 点击上传 -> 创建新流程`

![](https://i.loli.net/2021/06/02/VMWkRnhBZ2lKO91.png)

假设需要部署的 `监控日志套餐包` 已放置中控机的 `/data` 目录 ，`对应套餐包的标准运维流程模版` 已导入至标准运维。导入可参考如下:

![](https://i.loli.net/2021/06/02/ohlUZ94aqft8Nu1.png)

#### 3.2 正式部署

1、监控平台

选择 `[ce][deploy][bkmonitorv3]` 流程模版进行新建任务，根据提示填写相关信息。确认填写信息无误后，开始执行任务。

填写信息包括：

- `ctrl_ip`：基础环境的中控机 IP
- `whole_pkg_path`：部署监控平台安装包的绝对路径 `/data/bkmonitorv3_package-3.3.1731.tgz`
- `deply_iplist`：新增的机器 IP（如果基础环境的资源有富余，可以复用）

![](https://i.loli.net/2021/06/02/zH2Xe9x4yvZ6TCq.png)

该部署流程主要相关操作：

- 将监控平台安装包放至指定目录
- 生成监控平台 install.config 配置
- 初始化新增节点机器
- 授权监控平台所需的 MySQL 访问权限
- 安装监控相关依赖、监控平台后台、监控平台 SaaS

2、日志平台

选择 `[ce][deploy][bklog]` 流程模版进行新建任务，根据提示填写相关信息。确认填写信息无误后，开始执行任务。

填写信息包括：

- `ctrl_ip`：基础环境的中控机 IP
- `whole_pkg_path`：部署日志平台安装包的绝对路径 `/data/bklog_package-4.2.580.tgz`
- `deply_iplist`：新增的机器 IP（如果基础环境的资源有富余，可以复用）

![](https://i.loli.net/2021/06/02/ipj3XuhICo1YM7R.png)

该部署流程主要相关操作：

- 将日志平台安装包放至指定目录
- 生成日志平台 install.config 配置
- 初始化新增节点机器
- 授权日志平台所需的 MySQL 访问权限
- 安装日志平台相关依赖、日志平台后台、日志平台 SaaS

3、故障自愈

选择 `[ce][deploy][fta]` 流程模版进行新建任务，根据提示填写相关信息。确认填写信息无误后，开始执行任务。

该部署流程主要相关操作：

- `ctrl_ip`：基础环境的中控机 IP
- `whole_pkg_path`：部署故障自愈安装包的绝对路径 `/data/fta_package-5.2.14-ce.tgz`
- `deply_iplist`：新增的机器 IP（如果基础环境的资源有富余，可以复用）

![](https://i.loli.net/2021/06/02/7AnW1pP2vEmtkhd.png)

主要相关操作：

- 将故障自愈安装包放至指定目录
- 生成故障自愈 install.config 配置
- 初始化新增节点机器
- 授权故障自愈所需的 MySQL 访问权限
- 安装故障自愈相关依赖、故障自愈后台、故障自愈 SaaS

### 4.HTTP更改HTTPS

1、在中控机生成 $BK_DOMAIN 的自签名通配符证书，如果有外部签发的合法证书，可拷贝改名到$BK_PKG_SRC_PATH/cert/bk_domain.{crt,key} 两个文件。文件名的修改是为了匹配 nginx 模板默认名。

```bash
source /data/install/utils.fc

# 注意：openssl 这是一行命令
openssl req -x509 -days 365 -out $BK_PKG_SRC_PATH/cert/bk_domain.crt -keyout   $BK_PKG_SRC_PATH/cert/bk_domain.key \
-newkey rsa:2048 -nodes -sha256 \
-subj "/CN=*.$BK_DOMAIN" -extensions EXT -config <( \
printf "[dn]\nCN=*.$BK_DOMAIN\n[req]\ndistinguished_name = dn\n[EXT]\nsubjectAltName=DNS:*.$BK_DOMAIN\nkeyUsage=digitalSignature\nextendedKeyUsage=serverAuth")
```

2、同步并安装证书

```bash
./bkcli sync cert
./bkcli install cert 
```

3、将 BK_HTTP_SCHEMA 修改为 https，同时修改 JOB 的前端 API 地址。然后刷新 consul 中存储的键值，以及重新渲染 JOB 的前端页面。

```bash
source /data/install/utils.fc
cd $CTRL_DIR

# 自定义 global.env 配置相关URL和ADDR变量的变更，因为涉及到https切换，80端口也需要改为443
# 请注意域名的更改、如果前面将域名更改为自定义域名、以下代码在进行操作的时候请注意域名的更改
cat <<EOF >> $CTRL_DIR/bin/03-userdef/global.env 
BK_HTTP_SCHEMA=https

# 访问PaaS平台的域名
BK_PAAS_PUBLIC_URL="https://paas.bks.com"
BK_PAAS_PUBLIC_ADDR="paas.bks.com:443"
BK_PAAS_PRIVATE_ADDR="paas.service.consul:80"
BK_PAAS_PRIVATE_URL="http://paas.service.consul"

# 访问CMDB的域名
BK_CMDB_PUBLIC_ADDR="cmdb.bks.com:443"
BK_CMDB_PUBLIC_URL="https://cmdb.bks.com"

# 访问Job平台的域名
BK_JOB_PUBLIC_ADDR="job.bks.com:443"
BK_JOB_PUBLIC_URL="https://job.bks.com"
BK_JOB_API_PUBLIC_ADDR="jobapi.bks.com:443"
BK_JOB_API_PUBLIC_URL="https://jobapi.bks.com"
EOF

./bkcli install bkenv
./bkcli sync common

# 刷新 consul 中存储的值
consul kv put bkcfg/global/bk_http_schema https
```

4、渲染 PaaS 和 CMDB 配置并重启

```bash
./bkcli render paas
./bkcli restart paas

./bkcli render cmdb
./bkcli restart cmdb
```

5、渲染 job 的配置，并重启

```bash
# 刷新前端index.html调用的api地址
./pcmd.sh -m nginx '$CTRL_DIR/bin/release_job_frontend.sh -p $BK_HOME -s $BK_PKG_SRC_PATH -B $BK_PKG_SRC_PATH/backup -i $BK_JOB_API_PUBLIC_URL'

# 刷新job后台的web.url配置，并重启进程
./bkcli render job
./bkcli restart job
```

6、重新部署 SaaS，从 PaaS 中获取新的 BK_HTTP_SCHEMA(https)

```bash
./bkcli install saas-o 
```

7、打开浏览器，访问 https://paas.bks.com、系统做如下提示：

![image-20210604160801584](https://i.loli.net/2021/06/04/HhcrJZKBWNwa9kP.png)

因为HTTPS证书是自签名证书，所以需要点击浏览器“高级” ——>"继续前往paas.bks.com(不安全)"，如下图：

![](https://i.loli.net/2021/06/04/Uq9EeV6K1lQ2AtZ.jpg)

![](https://i.loli.net/2021/06/04/u5IT9rVtUgMszGq.png)

正常进入蓝鲸PaaS平台系统，输入用户名和密码，点击“登陆”，如下图：

![](https://i.loli.net/2021/06/04/7tRDYUWlw14fZEI.png)

![](https://i.loli.net/2021/06/04/fQg8m3nJVBiYxjX.png)

### 5.问题总结

#### 5.1 https访问

1、访问job

报错信息：更换https后进行job访问会出现网络问题、不能进行正常访问

![image-20210603100138354](https://i.loli.net/2021/06/03/ZVPnojNefB52pLu.png)

解决方案：在进行 job平台访问之前先访问jobapi.bks.com、访问过后在进行job的访问

jobapi.bks.com

![](https://i.loli.net/2021/06/03/yN5Ccz6x1ZqAFk4.png)

job访问

![image-20210603100822982](https://i.loli.net/2021/06/03/zFsIxTkJDlvfOVP.png)

2、权限中心

报错信息：访问权限中心出现空白页、最开始显示网络信息错误、后续将服务重启后访问页面出现502

解决方案：把utils.fc文件进行生效、在重新部署权限中心

```shell
#把文件utils.fc进行生效
source /data/install/utils.fc

#将iam服务进行停止
./bkcli stop saas-o bk_iam

#重装iam
./bk_install saas-o bk_iam
```

#### 5.2 监控平台

1、gse错误

报错信息：刷新界面出现“请求系统'gse'错误，返回错误码: 1000184，返回消息: exec redis_pipe_line_cmd failed，请求URL: get_agent_status ”

解决方案：将gse进行重启

```shell
./bkcli stop gse
./bkcli restart gse
```

2、监控数据未同步

报错信息：经检查时间未同步，check bkmonitorv03报错Problems found：基础性能dataid:1001的入库延迟10分钟以上、kafka正常有数据

![image-20210603104319887](https://i.loli.net/2021/06/03/6oXvBIzxQ97251y.png)

解决方案：重启transfer恢复

```shell
./bkcli restart bkmonitorv3 transfer
```

#### 5.3 流程管理

报错信息：部署流程管理显示部署超时

解决方案：将bk-yum进行重启、然后重新部署流程管理

```shell
#重启bk-yum
systemctl restart bk-yum

#部署流程管理
./bk_install saas-o bk-itsm
```

#### 5.4 访问SaaS页面502

报错信息：重启主机出现502

![image-20210603101027795](https://i.loli.net/2021/06/03/n6q1jSxpGWlefKv.png)

解决方案：重启主机后127.0.0.1地址会掉、需要将地址进行添加、然后重启paas、namemgr服务、以及出现502页面的平台组件都需要进行重启

```shell
#重启paas
./bkcli stop paas
./bkcli restart paas

#重启namemgr
./bkcli stop namemgr
./bkcli restart namemgr
```

#### 5.5 检查服务状态

报错信息：配置平台出现接口错误、导致故障自愈显示api接口出现异常以及监控平台出现502

![image-20210603102735646](https://i.loli.net/2021/06/03/eHBSWL8ospPuclA.png)



![image-20210603103041520](https://i.loli.net/2021/06/03/asTNhFtLuq2R17c.png)



![image-20210604113609069](https://i.loli.net/2021/06/04/1fV4wZC5dPngTRz.png)解决方案：将cmdb停止重启、重启之后访问配置、监控、日志平台、如果监控平台页面还是502需要将监控进行停止重启

```shell
#停止重启配置平台
./bkcli stop cmdb
./bkcli restart cmdb

#停止重启监控平台
./bkcli stop saas-o bkmonitorv3  
./bkcli restart saas-o bkmonitorv3  
```

#### 5.6 部署paas

报错信息：Error : Nothing to do /data/install/bin/install_consul.sh:line 151 with exit code 1

![image-20210603105602109](https://i.loli.net/2021/06/03/MHaU5qKeRPk3EfO.png)

报错原因;报错提示连接不上yum，在初始化环境的(initdata common)的时候会在中控机启动一个在线yum

解决方案：将yum停止重装

```shell
./bkcli stop yum
./bkcli install yum
```

#### 5.7 安装Proxy遇到CALLBACK_URL 不符合规范

![image.png](https://smartpublic-10032816.file.myqcloud.com/custom/20210510113226/96/20210510113226/--4968dfb11cb75c2906fd7049b4352a07.png)

临时处理方案：检查接入点信息是否正确，注意是填写nodeman所在机器的ip和nodeman的域名。

![image.png](https://smartpublic-10032816.file.myqcloud.com/custom/20210510113507/96/20210510113507/--d31e244893261aaaf6166872a03975f7.png)

nodeman所在机器修改脚本 /data/bkce/bknodeman/nodeman/bin/environ.sh

![image.png](https://smartpublic-10032816.file.myqcloud.com/custom/20210510113704/96/20210510113704/--5c7203a791eebfb4f87b8d9131493d1b.png)

中控机操作如下：

```shell
source /data/install/utils.fc
cd /data/install/
./bkcli restart bknodeman
```



### 6.附录

#### 6.1 **GSE端口网络策略** 

- 直连agent和GSE之间的互通策略

| 源地址    | 目标地址  | 协议    | 端口         | 用途             |
| :-------- | :-------- | :------ | :----------- | :--------------- |
| agent     | zk        | TCP     | 2181         | 获取配置         |
| agent     | gse_task  | TCP     | 48533        | 任务服务端口     |
| agent     | gse_data  | TCP     | 58625        | 数据上报端口     |
| agent     | gse_btsvr | TCP     | 59173        | bt传输           |
| agent     | gse_btsvr | TCP,UDP | 10020        | bt传输           |
| agent     | gse_btsvr | UDP     | 10030        | bt传输           |
| gse_btsvr | agent     | TCP,UDP | 60020-60030  | bt传输           |
| gse_btsvr | gse_btsvr | TCP     | 58930        | bt传输           |
| gse_btsvr | gse_btsvr | TCP,UDP | 10020        | bt传输           |
| gse_btsvr | gse_btsvr | UDP     | 10030        | bt传输           |
| agent     | agent     | TCP,UDP | 60020-60030  | bt传输           |
| agent     |           |         | 监听随机端口 | bt传输，可不开通 |
| gse_btsvr |           |         | 监听随机端口 | bt传输，可不开通 |

- proxy和GSE之间的互通策略

| 源地址             | 目标地址         | 协议    | 端口         | 用途                 |
| :----------------- | :--------------- | :------ | :----------- | :------------------- |
| proxy(gse_agent)   | gse_task         | TCP     | 48533        | 任务服务端口         |
| proxy(gse_transit) | gse_data         | TCP     | 58625        | 数据上报端口         |
| proxy(gse_btsvr)   | gse_btsvr        | TCP     | 58930        | bt传输               |
| proxy(gse_btsvr)   | gse_btsvr        | TCP,UDP | 10020        | bt传输               |
| proxy(gse_btsvr)   | gse_btsvr        | UDP     | 10030        | bt传输               |
| gse_btsvr          | proxy(gse_btsvr) | TCP     | 58930        | bt传输               |
| gse_btsvr          | proxy(gse_btsvr) | TCP,UDP | 10020        | bt传输               |
| gse_btsvr          | proxy(gse_btsvr) | UDP     | 10030        | bt传输               |
| proxy(gse_btsvr)   | proxy(gse_btsvr) | TCP     | 58930        | bt传输（同一子网）   |
| proxy(gse_btsvr)   | proxy(gse_btsvr) | TCP,UDP | 10020        | bt传输（同一子网）   |
| proxy(gse_btsvr)   | proxy(gse_btsvr) | UDP     | 10030        | bt传输（同一子网）   |
| proxy(gse_opts)    | gse_ops          | TCP     | 58725        | ping告警数据上报端口 |
| proxy(gse_agent)   |                  |         | 监听随机端口 | bt传输，可不开通     |
| proxy(gse_btsvr)   |                  |         | 监听随机端口 | bt传输，可不开通     |

- proxy下agent和proxy之间的互通策略

| 源地址           | 目标地址           | 协议    | 端口         | 用途             |
| :--------------- | :----------------- | :------ | :----------- | :--------------- |
| agent            | proxy(gse_agent)   | TCP     | 48533        | 任务服务端口     |
| agent            | proxy(gse_transit) | TCP     | 58625        | 数据上报端口     |
| agent            | proxy(gse_btsvr)   | TCP     | 59173        | bt传输           |
| agent            | proxy(gse_btsvr)   | TCP,UDP | 10020        | bt传输           |
| agent            | proxy(gse_btsvr)   | UDP     | 10030        | bt传输           |
| proxy(gse_btsvr) | agent              | TCP,UDP | 60020-60030  | bt传输           |
| agent            | agent              | TCP,UDP | 60020-60030  | bt传输(同一子网) |
| agent            |                    |         | 监听随机端口 | bt传输，可不开通 |
## 电信安全基线操作手册

### 一、nginx安全基线操作

#### 1.nginx自定义返回错误码

```shell
source utils.fc
ssh $BK_NGINX_IP
#在server字段中添加自定义错误返回码，可见图1.1
vim /usr/local/openresty/nginx/conf/conf.d/bknetwork.conf 
error_page   404 400 413  /404.html;
location = /404.html {
}
error_page   500 502 503 504  /50x.html;

#在server字段中添加自定义错误返回码，可见图1.2
vim /usr/local/openresty/nginx/conf/conf.d/bknetwork.conf
error_page   404 400 413  /404.html;
location = /404.html {
}
error_page   500 502 503 504  /50x.html;
location = /50x.html {
}

#在server字段中添加自定义错误返回码，可见图1.3
vim /usr/local/openresty/nginx/conf/conf.d/job.conf
#此文件需添加两处
error_page   404 400 413  /404.html;
location = /404.html {
}
error_page   500 502 503 504  /50x.html;
location = /50x.html {
}

#在server字段中添加自定义错误返回码，可见图1.4
vim /usr/local/openresty/nginx/conf/conf.d/paas.conf
#此文件也需要添加两处
error_page   404 400 413  /404.html;
location = /404.html {
}
error_page   500 502 503 504  /50x.html;
location = /50x.html {
}

#在server字段中添加自定义错误返回码，可见图1.5
vim /usr/local/openresty/nginx/conf/conf.d/paasagent.conf
error_page   404 400 413  /404.html;
location = /404.html {
}
error_page   500 502 503 504  /50x.html;
location = /50x.html {
}



#nginx两端都需要进行修改

#上传404默认文件到/usr/local/openresty/nginx/html下
```

##### 1.1 bknetwork

![image-20220425102957033](http://xwyhhhh1.test.upcdn.net/image-20220425102957033.png)

##### 1.2 cmdb

![image-20220424172900599](http://xwyhhhh1.test.upcdn.net/image-20220424172900599.png)

##### 1.3 job

![image-20220425102307765](http://xwyhhhh1.test.upcdn.net/image-20220425102307765.png)

![image-20220425102431768](http://xwyhhhh1.test.upcdn.net/image-20220425102431768.png)

##### 1.4 paas

![image-20220425105432715](http://xwyhhhh1.test.upcdn.net/image-20220425105432715.png)

![image-20220425110051976](http://xwyhhhh1.test.upcdn.net/image-20220425110051976.png)

##### 1.5 paasagent

![image-20220425110509960](http://xwyhhhh1.test.upcdn.net/image-20220425110509960.png)

#### 2.nginx限制客户端下载速度

```shell
cd /data/install
source ./utils.fc
ssh $BK_NGINX_IP
vim /usr/local/openresty/nginx/conf/nginx.conf
#添加全局限制limit_rate,limit_conn如图2.1
limit_conn_zone $binary_remote_addr zone=addr:10m;
limit_conn addr  5;
limit_rate  1000k;
```

##### 2.1 限制设置

![image-20220425112307905](http://xwyhhhh1.test.upcdn.net/image-20220425112307905.png)

#### 3.控制超时时间

```shell
cd /data/install
source ./utils.fc
ssh $BK_NGINX_IP
vim /usr/local/openresty/nginx/conf/nginx.conf
#在全局http字段添加超时设置client_body_timeout,client_header_timeout,send_timeout，见图3.1
client_body_timeout  60s;
client_header_timeout  60s;
send_timeout  60s;
```

##### 3.1超时设置

![image-20220425112435695](http://xwyhhhh1.test.upcdn.net/image-20220425112435695.png)

### 二、操作系统安全基线操作

####1.配置登陆时间超时变量

```shell
#此为判断是否有超时变量操作
echo $TMOUT
#添加全局登录超时变量,可见图1.1
vim /etc/profile
export TMOUT=300
#加载文件
source /etc/profile
```

##### 1.1登陆时间超时设置

![image-20220424143543033](http://xwyhhhh1.test.upcdn.net/image-20220424143543033.png)

#### 2.设置密码过期时间

```shell
vim /etc/login.defs
#查看PASS_MAX_DAYS字段，此为密码最大有效期时间。可见图3.1
PASS_MAX_DAYS  90
```

##### 2.1密码过期时间

![image-20220421165940011](http://xwyhhhh1.test.upcdn.net/image-20220421165940011.png)

#### 3.密码复杂度设置

```shell
vim /etc/pam.d/system-auth
#找到password   requisite   pam_cracklib.so字段，替换此字段之后的值，见图3.1
password requisite pam_cracklib.so retry=5 difok=3 minlen=8 minclass=3
vim /etc/login.defs
#找到PASS_MIN_LEN字段，将值改为8; 可见图3.2
PASS_MIN_LEN	8
```

##### 3.1密码复杂程度设置

![image-20220424151754115](http://xwyhhhh1.test.upcdn.net/image-20220424151754115.png)

##### 3.2

![image-20220424152342509](http://xwyhhhh1.test.upcdn.net/image-20220424152342509.png)



#### 4.配置文件与目录缺省权限控制 

```shell
vim /etc/profile
#修改if判断下的umask值，此为针对所有用户,可见图4.1
umask 027（其它用户，其他用户无权限）
source /etc/profile
```

##### 5.1配置图

![image-20220424145254919](http://xwyhhhh1.test.upcdn.net/image-20220424145254919.png)

#### 5.支持远程日志开启

```shell
vim /etc/rsyslog.conf
#取消$ModLoad imtcp、$InputTCPServerRun 514这两个字段的注释，可见5.1图
systemctl restart rsyslog.service
netstat -tnulp | grep 514
```

##### 5.1取消注释

![image-20220421190528702](http://xwyhhhh1.test.upcdn.net/image-20220421190528702.png)
































### 监控平台排错过程

#### 1.起因：进入监控平台报错，

![image-20220329133944686](http://xwyhhhh1.test.upcdn.net/image-20220329133944686.png)



#### 2.监控平台还能进去，首先确定插件是否出问题，结果是插件都未起来，经过重启插件，采集数据的插件都已经正常

![image-20220329134302899](http://xwyhhhh1.test.upcdn.net/image-20220329134302899.png)

#### 3.正常来说插件好了数据应该能上来，但是监控平台还是在报错，在社区查到的是稍等一会数据才能上来，在静待一段时间后，错误并没有解决，这证明，错误并不是由于插件引起的。监控平台还能访问，去查看相关选项

##### 3.1采集状态未知，根本没有数据上来，但是插件在正常运行，状态未知，证明数据库里大概是没有获取到数据，因为状态是未知。

![image-20220329134729033](http://xwyhhhh1.test.upcdn.net/image-20220329134729033.png)

##### 3.2查看自监控选项，gse报红，数据库也报黄说kafka出现问题

![image-20220329134919284](http://xwyhhhh1.test.upcdn.net/image-20220329134919284.png)

##### 3.2.1这个时候我去查看了gse状态和检查gse，并没有出现问题，这个时候就要去看日志

![image-20220329135136316](http://xwyhhhh1.test.upcdn.net/image-20220329135136316.png)

#### 4.进入gse所在主机查看日志发现问题，报错如下

```shell
ssh $(grep gse /data/install/install.config)
cd /data/bkce/logs/gse
tail -f *.log
```

![image-20220329135446735](http://xwyhhhh1.test.upcdn.net/image-20220329135446735.png)

![image-20220329135503279](http://xwyhhhh1.test.upcdn.net/image-20220329135503279.png)

##### 4.1发现日志提到错误influxdb_proxyb报错，在自监控中报错为kafka，于是尝试重启kafka

```shell
cd /data/install
./bkcli restart kafka
```

##### 4.2结果是并没有太大作用，还是黄并且监控平台依然报错，这个时候只能去看看kafka到底怎么回事，因为gse报infludb_proxy错误，这表明可能kafka的数据并没有移交给influxdb，导致influxdb没有数据等等问题。

```shell
ssh $(grep kafka /data/install/install/config)
cd /var/log/kafka
tail -f *.log
```

![image-20220329140522725](http://xwyhhhh1.test.upcdn.net/image-20220329140522725.png)

##### 4.3结果显而易见，集群全部挂掉，但是我并不知道要如何做，但是我想到了consul，consul提供服务的自动发现和注册，加入集群挂掉，但是进程还在我觉得可以去看看consul

![image-20220329140746520](http://xwyhhhh1.test.upcdn.net/image-20220329140746520.png)

##### 4.4三个报错，很显而易见的事情是influxdb，license报错，这个时候干脆一点，直接检查全部服务最好，看到有多少挂掉的

- 因为没有截图我只能文字描述

###### 4.5查询完毕之后发现license，influxdb报错还有其它组件，开始尝试一一重启，尝试完毕之后自监控页面正常，但是刷新几次后又红，我尝试重启gse，再次刷新已经复原了，然后又红，但是又复原了，然后就没问题了。过了一会，尝试查看监控界面，没有报错了，查看仪表盘数据也出来了![image-20220329141404785](http://xwyhhhh1.test.upcdn.net/image-20220329141404785.png)

##### 5总结：

- 遇到错误查看日志是个好习惯
- 学会使用正则表达式，这样能够查询日志
- 了解各个公共组件所带来的作用这样才能有解决问题的资本
